////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ОБЩЕГО НАЗНАЧЕНИЯ

&НаСервере
Процедура НастройкаДереваГрупп()
	//// Спрячем элемент управления, дабы все действия проходили быстрее
	//Элементы.Дерево.Видимость = ЛОЖЬ;
	
	// Настроим элемент управления на нужный тип данных
	Дерево.ОсновнаяТаблица = "Справочник." + ВидСправочника;
	Элементы.Дерево.ТолькоПросмотр = Истина;
	
	// Установим все необходимые настройки
	//ЭлементыФормы.Дерево.Значение.Отбор.ЭтоГруппа.Значение		= ИСТИНА;
	//ЭлементыФормы.Дерево.Значение.Отбор.ЭтоГруппа.Использование	= ИСТИНА;
	Если Метаданные.Справочники[ВидСправочника].Иерархический Тогда
		ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбора(Дерево.Отбор, "ЭтоГруппа", Истина);
	КонецЕсли;
	
	//// ... а теперь и для колонки
	//Колонка						= ЭлементыФормы.Дерево.Колонки.Добавить("Наименование");
	//Колонка.Данные				= "Наименование";
	//Колонка.ОтображатьИерархию	= ИСТИНА;
	//Колонка.УстановитьЭлементУправления(Тип("ПолеВвода"));
	
	//// Все готово, можно показывать
	//Элементы.Дерево.Видимость = ИСТИНА;
КонецПроцедуры

&НаКлиенте
Процедура Оповещение()
	Если Элементы.Дерево.ТекущиеДанные = Неопределено ИЛИ Элементы.Дерево.ТекущиеДанные.Ссылка.Пустая() Тогда
		Возврат;
	КонецЕсли; 
	
	ВыбранноеЗначение = Новый Структура;
	ВыбранноеЗначение.Вставить("Значение", Элементы.Дерево.ТекущиеДанные.Ссылка);
	ВыбранноеЗначение.Вставить("УстанавливатьПометку", УстанавливатьПометку);
	ОповеститьОВыборе(ВыбранноеЗначение);
КонецПроцедуры


////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ КОМАНД ФОРМЫ

&НаКлиенте
Процедура Выбрать(Команда)
	Оповещение();
КонецПроцедуры


////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ ЭЛЕМЕНТОВ УПРАВЛЕНИЯ ФОРМЫ

&НаКлиенте
Процедура ДеревоВыборЗначения(Элемент, Значение, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
    Оповещение();
КонецПроцедуры


////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ - ОБРАБОТЧИКИ КОМАНД ФОРМЫ

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если Параметры.Свойство("АвтоТест") Тогда // Возврат при получении формы для анализа.
		АвтоТест = Истина;
		Возврат;
	КонецЕсли;
	Если Параметры.Свойство("ВидСправочника") Тогда
		ВидСправочника = Параметры.ВидСправочника;
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	Если АвтоТест Тогда
		Возврат;
	КонецЕсли;
	
	Если ВладелецФормы = Неопределено Тогда
		СтандартнаяОбработка = Ложь;
		Отказ = Истина;
		ПоказатьПредупреждение(Неопределено, "Данная обработка вызывается из других процедур конфигурации.
			|Вручную ее вызывать запрещено!", 10);
		Возврат;
	КонецЕсли;
	
	НастройкаДереваГрупп();
КонецПроцедуры
